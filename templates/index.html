{% extends "base.html" %}

{% block content %}
<!-- Animated Background Bubbles -->
<div class="bubble-background">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
</div>

<div class="row h-100">
    <div class="col-12">
        <div class="chat-container">
            <div class="chat-header">
                <h4><i class="fas fa-robot"></i> Agentic RAG Assistant</h4>
                <div class="connection-status">
                    <span id="status-indicator" class="badge bg-warning">Connecting...</span>
                </div>
            </div>
            
<div class="mb-2">
  <input type="text" id="chatFilterInput" class="form-control" placeholder="Filter messages...">
</div>
<div class="chat-messages" id="chatMessages">
    <div class="message assistant-message">
        <div class="message-content">
            <strong>ðŸ¤– Assistant:</strong> Hello! I'm your Agentic RAG assistant. I have access to a knowledge base and can remember our conversation. How can I help you today?
        </div>
        <div class="message-timestamp">Just now</div>
    </div>
</div>
            
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="typing-text">Assistant is typing...</span>
            </div>
            
            <div class="chat-input">
                <!-- Search Bar -->
                <div class="search-section mb-3" id="searchSection" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <h6><i class="fas fa-search"></i> Search Knowledge Base</h6>
                            <form id="searchForm">
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" id="searchQuery" 
                                           placeholder="Search the knowledge base..." required>
                                    <button class="btn btn-outline-secondary" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label for="topK" class="form-label small">Results:</label>
                                        <input type="number" class="form-control form-control-sm" 
                                               id="topK" value="5" min="1" max="10">
                                    </div>
                                    <div class="col-6 d-flex align-items-end">
                                        <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                id="closeSearchBtn">
                                            <i class="fas fa-times"></i> Close
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <div id="searchResults" class="mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <form id="chatForm">
                    <div class="input-group">
                        <button type="button" class="btn btn-outline-secondary" id="searchToggleBtn" 
                                title="Search Knowledge Base">
                            <i class="fas fa-search"></i>
                        </button>
                        <input type="text" class="form-control" id="messageInput" 
                               placeholder="Type your message here..." autocomplete="off">
                        <button class="btn btn-primary" type="submit" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions Modal -->
<div class="modal fade" id="quickActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Quick Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12 mb-3">
                        <h6>Sample Questions:</h6>
                        <div class="quick-questions">
                            <button class="btn btn-outline-primary btn-sm me-2 mb-2 quick-question">
                                What is artificial intelligence?
                            </button>
                            <button class="btn btn-outline-primary btn-sm me-2 mb-2 quick-question">
                                Explain machine learning
                            </button>
                            <button class="btn btn-outline-primary btn-sm me-2 mb-2 quick-question">
                                What is RAG?
                            </button>
                            <button class="btn btn-outline-primary btn-sm me-2 mb-2 quick-question">
                                How do vector databases work?
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button -->
<button class="fab" id="quickActionsBtn" data-bs-toggle="modal" data-bs-target="#quickActionsModal">
    <i class="fas fa-question"></i>
</button>

<!-- Test Bubble Button for Debugging -->
<button class="fab" id="testBubbleBtn" style="right: 80px; background: #28a745;" onclick="createManualTestBubble()">
    <i class="fas fa-magic"></i>
</button>

<!-- Dark Mode Toggle -->
<button class="dark-mode-toggle" id="darkModeToggle" title="Toggle Dark Mode" onclick="toggleDarkMode()">
    <i class="fas fa-moon"></i>
</button>
{% endblock %}

{% block scripts %}
<!-- External main.js will handle all chat and UI logic -->
<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
{% endblock %}